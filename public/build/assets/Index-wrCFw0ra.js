import{T as he,q as T,r as h,t as be,p as A,s as xe,a as b,b as p,d as a,u as o,Z as ye,k as we,m as F,e as m,x as V,l as _e,w as Me,o as v,y as Be,F as I,z as Ce}from"./vendor-vue-BnW7Nrl4.js";import{A as ke}from"./AuthenticatedLayout-DkiVbQMP.js";import{d as Y}from"./vendor-core-CzOEOszY.js";import De from"./FinanceHeader-D-wbtbd8.js";import Ee from"./FinanceStats-Dc_0zdlF.js";import $e from"./BudgetSidebar-BBEPQcDv.js";import Fe from"./TransactionModal-76lLeyD4.js";import Te from"./BudgetModal-C2VSJCAp.js";import Ye from"./CategoryModal-BDmVpos3.js";import Oe from"./DailyTrendChart-7NHiqW5b.js";import Se from"./ArchiveModal-DrZkqXk1.js";import{u as je,F as Ae}from"./FinanceInsights-CnqxO9PJ.js";import Re from"./FinanceDatePicker--Rd7IAaB.js";import ze from"./FinanceBatchModal-C2TYJHqu.js";import{S as Le}from"./vendor-utils-vWQA-h1x.js";import{u as R}from"./useFinanceFormat-BzdLqOPi.js";import{N as P}from"./vendor-inertia-DLGDmWoM.js";import{u as Ne}from"./useFinanceHistory-C6JVYW5k.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-DJaFAnPu.js";import"./TextInput-BVYhg6rt.js";import"./PrimaryButton-ElD7YGox.js";import"./SecondaryButton-CoYwdmRS.js";function Ve(u){const c=h(!1),r=h(null),{cleanAmount:d}=R(),i=(n,g)=>{const w=be(n);return w!==n?w:g},y=(n,g)=>{Le.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,background:"#4f46e5",iconColor:"#ffffff",icon:n,title:`<span style="color: white; font-weight: 900; font-size: 14px; line-height: 1.2;">${g}</span>`,customClass:{container:"!fixed !top-5 !right-5 !p-0 !z-[100000] !items-start !justify-end",popup:"!flex !items-center !gap-3 !py-3 !px-6 !rounded-full !shadow-2xl !border-none !m-0 !w-auto !min-w-[280px]",timerProgressBar:"!bg-white/40 !h-1 !rounded-b-full"}})},l=he({date:u.value,transactions:[{type:"expense",category:"",title:"",amount:""}]});T(()=>u.value,n=>{c.value||(l.date=n)});const M=()=>{l.reset(),l.date=u.value,l.transactions=[{type:"expense",category:"",title:"",amount:""}],l.clearErrors(),r.value=null,c.value=!0},f=()=>{c.value=!1,l.reset(),l.clearErrors()},B=()=>{l.transactions.push({type:"expense",category:"",title:"",amount:""})},O=n=>{l.transactions.length>1&&l.transactions.splice(n,1)},S=()=>{l.clearErrors(),r.value=null;let n=!0;return l.date?(l.transactions.forEach((g,w)=>{g.title||(l.setError(`transactions.${w}.title`,i("warn_empty_title","Required")),n=!1),g.category||(l.setError(`transactions.${w}.category`,i("warn_empty_category","Required")),n=!1),(!g.amount||d(g.amount)<=0)&&(l.setError(`transactions.${w}.amount`,i("warn_empty_amount","Required")),n=!1)}),n||y("warning",i("warn_empty_fields","Lengkapi semua baris transaksi!")),n):(y("warning",i("warn_empty_date","Pilih tanggal transaksi!")),!1)};return{isBatchModalOpen:c,batchForm:l,globalConflictError:r,openBatchModal:M,closeBatchModal:f,addBatchRow:B,removeBatchRow:O,submitBatch:()=>{if(!S())return;const n={date:l.date,transactions:l.transactions.map(g=>({...g,amount:d(g.amount)}))};y("success",i("success_saved","Menyimpan Batch...")),P.post(route("finance.transaction.batchStore"),n,{preserveScroll:!0,preserveState:!0,progress:!1,only:["transactions","stats","budgets","categories","errors"],onSuccess:()=>{f()},onError:()=>{y("error",i("err_save_failed","Gagal menyimpan data!"))}})}}}function Ie(u){const{activeLocale:c}=R(),r=h(Y(u)),d=A(()=>!c||!c.value?"en":c.value.split("-")[0]),i=M=>{let f;M==="next"?f=r.value.add(1,"month"):M==="prev"?f=r.value.subtract(1,"month"):f=Y(`${M}-01`),r.value=f,P.get(route("finance.index"),{date:f.format("YYYY-MM-DD")},{preserveState:!0,preserveScroll:!0,replace:!0,only:["transactions","budgets","stats","filters"]})},y=A(()=>r.value.locale(d.value).format("MMMM YYYY")),l=A(()=>r.value.format("YYYY-MM"));return{currentDate:r,changeMonth:i,formattedMonth:y,currentMonthKey:l}}const Pe={class:"w-full min-h-screen bg-slate-50/50 px-4 sm:px-6 lg:px-8 py-8"},qe={class:"mb-8"},Ke={class:"grid grid-cols-1 lg:grid-cols-5 gap-8 items-start"},He={class:"lg:col-span-3 space-y-8 w-full"},Ue={class:"space-y-4"},Ge={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-3"},Ze={class:"flex items-center gap-2"},Je={class:"text-lg font-bold text-slate-800"},Qe={key:0,class:"text-[10px] font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded-lg"},We={key:1,class:"text-[10px] font-bold text-indigo-500 bg-indigo-50 px-2 py-1 rounded-lg"},Xe={class:"relative z-30"},et={class:"flex items-center gap-2"},tt={class:"absolute right-3 text-slate-400 text-[10px]"},st={key:0,class:"absolute right-0 top-full mt-2 z-50 origin-top-right"},at={key:0,class:"text-center py-12 bg-white rounded-3xl border border-dashed border-slate-200"},ot={class:"text-slate-400 text-sm font-medium"},nt={key:1,class:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden divide-y divide-slate-50"},rt=["onClick"],lt={class:"flex items-center gap-4"},it={class:"w-12 h-12 rounded-xl bg-slate-50 border border-slate-100 flex flex-col items-center justify-center group-hover:bg-white transition-all shadow-sm"},ct={class:"text-[10px] uppercase font-black text-slate-400 leading-none"},dt={class:"text-xl font-black leading-none text-slate-700 mt-0.5"},ut={class:"font-bold text-slate-700 text-sm capitalize"},mt={class:"text-[11px] text-slate-400 font-bold bg-slate-50 px-1.5 py-0.5 rounded border border-slate-100 mt-1 inline-block"},ft={class:"flex items-center gap-6"},gt={class:"pl-4 border-l border-slate-100 text-right"},pt={class:"block text-[9px] font-bold text-slate-400 uppercase tracking-wider"},vt={key:0,class:"bg-slate-50/50 p-2.5 text-center border-t border-slate-100"},ht={class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},bt={class:"lg:col-span-2 w-full md:sticky md:top-24 h-fit space-y-6"},It=Object.assign({layout:ke},{__name:"Index",props:{transactions:Array,budgets:Array,stats:Object,filters:Object,categories:Array},setup(u){const c=u,r=h([...c.transactions]),d=h([...c.budgets]),i=h([...c.categories]);T(()=>c.transactions,e=>r.value=[...e],{deep:!0}),T(()=>c.budgets,e=>d.value=[...e],{deep:!0}),T(()=>c.categories,e=>i.value=[...e],{deep:!0});const y=xe({...c,get transactions(){return r.value},get budgets(){return d.value},get categories(){return i.value}}),{formattedMonth:l,changeMonth:M,currentMonthKey:f}=Ie(c.filters.date),{transactionForm:B,setEditTransaction:O,submitTransaction:S,deleteTransaction:z,budgetForm:n,submitBudget:g,deleteBudget:w,categoryForm:$,setEditCategory:q,submitCategory:K,deleteCategory:H,updateIncomeTarget:U}=je(),_=h(!1),C=h(!1),k=h(!1),D=h(!1),G=h(c.filters.date||Y().format("YYYY-MM-DD")),{isBatchModalOpen:Z,batchForm:J,globalConflictError:Q,openBatchModal:W,closeBatchModal:L,addBatchRow:X,removeBatchRow:ee,submitBatch:te}=Ve(G),{visibleStats:N,filterDate:x,isArchiveOpen:j,selectedDayData:se,openDetail:ae}=Ne(y),{formatMoney:oe}=R(),ne=e=>{O(e),_.value=!0},re=e=>{const s=i.value.find(t=>t.slug===e.category);n.id=e.id,n.category=e.category,n.name=s?s.name:e.category,n.icon=s?s.icon:"ðŸ’¸",n.limit_amount=e.limit_amount,n.month=e.month||f.value,C.value=!0},le=e=>{$.id=e.id,q(e),k.value=!0},ie=()=>{$.reset(),$.id=null,k.value=!0},ce=()=>{S({onOptimistic:(e,s)=>{if(_.value=!1,s){const t=r.value.findIndex(E=>E.id===e.id);t!==-1&&Object.assign(r.value[t],e)}else r.value.unshift(e)},onError:(e,s)=>{s||(r.value=r.value.filter(t=>t.id!==e)),_.value=!0}})},de=e=>{j.value=!1,z(e,{onOptimistic:s=>{r.value=r.value.filter(t=>t.id!==s)}})},ue=()=>{C.value=!1,g(f.value,{onOptimistic:(e,s)=>{if(s){const t=d.value.findIndex(E=>E.id===e.id);t!==-1&&Object.assign(d.value[t],e)}else d.value.push(e)},onError:(e,s)=>{s||(d.value=d.value.filter(t=>t.id!==e)),C.value=!0}})},me=e=>{w(e,{onOptimistic:s=>{d.value=d.value.filter(t=>t.id!==s)}})},fe=()=>{k.value=!1,K({onOptimistic:(e,s)=>{if(s){const t=i.value.findIndex(E=>E.id===e.id);t!==-1&&Object.assign(i.value[t],e)}else i.value.push(e)},onError:(e,s)=>{s||(i.value=i.value.filter(t=>t.id!==e)),k.value=!0}})},ge=e=>{H(e,{onOptimistic:s=>{i.value=i.value.filter(t=>t.id!==s)}})},pe=()=>{_.value=!1,setTimeout(()=>{W()},150)},ve=()=>{L(),setTimeout(()=>{B.reset(),B.id=null,_.value=!0},150)};return(e,s)=>(v(),b(I,null,[p(o(ye),{title:"Finance Plan"}),a("div",null,[p(De,{currentMonth:o(l),currentMonthKey:o(f),onChangeDate:t=>o(M)(t),onAddClick:()=>{o(B).reset(),o(B).id=null,_.value=!0}},null,8,["currentMonth","currentMonthKey","onChangeDate","onAddClick"]),a("div",Pe,[a("div",qe,[p(Ee,{stats:u.stats,onUpdateTarget:t=>o(U)(o(f),t)},null,8,["stats","onUpdateTarget"])]),a("div",Ke,[a("div",He,[a("div",Ue,[a("div",Ge,[a("div",Ze,[a("h3",Je,m(e.$t("daily_history")),1),o(x)?(v(),b("span",We,m(e.$t("search_result")),1)):(v(),b("span",Qe,m(e.$t("last_5")),1))]),a("div",Xe,[a("div",et,[a("button",{onClick:s[0]||(s[0]=t=>D.value=!D.value),class:V(["pl-3 pr-8 py-2 text-xs font-bold bg-white border border-slate-200 rounded-xl shadow-sm hover:border-indigo-300 hover:ring-2 hover:ring-indigo-500/10 transition-all flex items-center gap-2 min-w-[150px] relative",o(x)?"text-indigo-600 border-indigo-200":"text-slate-500"])},[s[5]||(s[5]=a("span",{class:"text-base"},"ðŸ“…",-1)),a("span",null,m(o(x)?o(Y)(o(x)).locale(e.$page.props.locale).format("DD MMM YYYY"):e.$t("date_filter")),1),a("span",tt,m(D.value?"â–²":"â–¼"),1)],2),o(x)?(v(),b("button",{key:0,onClick:s[1]||(s[1]=_e(t=>x.value="",["stop"])),class:"text-slate-300 hover:text-rose-500 hover:bg-rose-50 p-1.5 rounded-lg transition-all border border-transparent hover:border-rose-100",title:"Hapus Filter"},[...s[6]||(s[6]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])):F("",!0)]),p(Be,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-2"},{default:Me(()=>[D.value?(v(),b("div",st,[p(Re,{show:D.value,modelValue:o(x),transactions:r.value,"onUpdate:modelValue":s[2]||(s[2]=t=>x.value=t),onClose:s[3]||(s[3]=t=>D.value=!1)},null,8,["show","modelValue","transactions"])])):F("",!0)]),_:1})])]),r.value.length===0?(v(),b("div",at,[s[7]||(s[7]=a("div",{class:"text-3xl mb-2"},"ðŸ“’",-1)),a("p",ot,m(e.$t("no_transaction")),1)])):(v(),b("div",nt,[(v(!0),b(I,null,Ce(o(N),t=>(v(),b("div",{key:t.date,onClick:E=>o(ae)(t),class:"group p-4 flex items-center justify-between hover:bg-indigo-50/50 transition-colors cursor-pointer"},[a("div",lt,[a("div",it,[a("span",ct,m(t.dateObj.format("MMM")),1),a("span",dt,m(t.dateObj.format("DD")),1)]),a("div",null,[a("h4",ut,m(t.dateObj.format("dddd")),1),a("span",mt,m(e.$t("transaction_count",{count:t.transactions.length})),1)])]),a("div",ft,[a("div",gt,[a("span",pt,m(e.$t("daily_net")),1),a("span",{class:V(["text-sm font-black font-mono",t.total_income-t.total_expense>=0?"text-indigo-600":"text-orange-500"])},m(t.total_income-t.total_expense>=0?"+":"")+m(o(oe)(t.total_income-t.total_expense)),3)]),s[8]||(s[8]=a("span",{class:"text-slate-300 group-hover:text-indigo-400 transition-colors"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})])],-1))])],8,rt))),128)),!o(x)&&o(N).length===5?(v(),b("div",vt,[a("p",ht,m(e.$t("old_data_hint")),1)])):F("",!0)])),p(Se,{show:o(j),dayData:o(se),categories:u.categories,close:()=>j.value=!1,onDelete:de,onEdit:ne},null,8,["show","dayData","categories","close"])]),r.value.length?(v(),we(Oe,{key:0,transactions:r.value,currentDate:u.filters.date},null,8,["transactions","currentDate"])):F("",!0)]),a("div",bt,[p($e,{budgets:d.value,categories:i.value,expenseStats:u.stats.expense_by_category,incomeStats:u.stats.income_by_category,onAdd:s[4]||(s[4]=()=>{o(n).reset(),o(n).id=null,C.value=!0}),onDeleteBudget:me,onEditBudget:re,onAddCategory:ie,onEditCategory:le,onDeleteCategory:ge},null,8,["budgets","categories","expenseStats","incomeStats"]),p(Ae,{"expense-stats":u.stats.expense_by_category,"income-stats":u.stats.income_by_category,budgets:d.value},null,8,["expense-stats","income-stats","budgets"])])]),p(Fe,{show:_.value,form:o(B),budgets:d.value,categories:u.categories,close:()=>_.value=!1,submit:ce,onSwitchToBatch:pe},null,8,["show","form","budgets","categories","close"]),p(ze,{show:o(Z),form:o(J),categories:u.categories,budgets:d.value,conflictError:o(Q),close:o(L),submit:o(te),addRow:o(X),removeRow:o(ee),switchToSingle:ve},null,8,["show","form","categories","budgets","conflictError","close","submit","addRow","removeRow"]),p(Te,{show:C.value,form:o(n),categories:u.categories,close:()=>C.value=!1,submit:ue},null,8,["show","form","categories","close"]),p(Ye,{show:k.value,form:o($),close:()=>k.value=!1,submit:fe},null,8,["show","form","close"])])])],64))}});export{It as default};
