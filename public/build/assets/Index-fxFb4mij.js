import{r as S,T as z,B as M,p as N,t as Q,Q as J,a as Z,b as $,d as j,u as o,Z as K,S as I,F as X,o as L}from"./vendor-vue-DauRGcU0.js";import{A as tt}from"./AuthenticatedLayout-CBYjT401.js";import{S as O,a as U}from"./vendor-utils-DJxZWvYm.js";import{N as R}from"./vendor-inertia-DdYq9B8h.js";import{d as W}from"./vendor-core-CR-nZrr5.js";import et from"./PlannerHeader-Cmy11zDs.js";import at from"./PlannerSidebar-DQDw5HOl.js";import rt from"./PlannerTimeline-Djx6vtVB.js";import st from"./PlannerModal-CKODXXBp.js";import ot from"./PlannerBatchModal-DXdT9mzR.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PlannerDatePicker-D7l0sw7P.js";import"./Modal-BaKyiO_R.js";import"./InputLabel-BcWvH4Jd.js";import"./TextInput-OKSiZA2l.js";import"./PrimaryButton-PYkNO_iO.js";import"./SecondaryButton-DxRvAQCY.js";function lt(n){const l=S([...n.tasks]),i=S(null),e=S(!1),f=S(!1),h=S("full"),a=z({id:null,date:n.currentDate,title:"",start_time:null,end_time:null,type:1,notes:""});M(()=>n.currentDate,t=>{a.date=t});const c=(t,s)=>{const p=Q(t);return p!==t?p:s},u=(t,s,p="#4f46e5")=>{O.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,background:p,iconColor:"#ffffff",icon:t,title:`<span style="color: white; font-weight: 900; font-size: 14px;">${s}</span>`,customClass:{container:"!fixed !top-5 !right-5 !p-0 !z-[100000] !items-start !justify-end",popup:"!flex !items-center !gap-3 !py-3 !px-6 !rounded-full !shadow-2xl !border-none !w-auto !h-auto !min-w-[280px] !m-0"}})},w=t=>u("warning",t,"#4f46e5"),D=t=>u("success",t,"#4f46e5"),g=t=>u("error",t,"#4f46e5"),d=t=>{if(!t)return 0;const[s,p]=t.split(":").map(Number);return s*60+p},m=()=>{if(i.value=null,!a.start_time||!a.end_time)return;const t=d(a.start_time);let s=d(a.end_time);if(s<t&&(s+=1440),s-t<15){i.value=`⛔ ${c("err_min_15_mins","Minimal 15 menit!")}`;return}l.value.some(B=>{if(f.value&&B.id===a.id||!B.start_time)return!1;const P=d(B.start_time);let A=B.end_time?d(B.end_time):P+60;return A<P&&(A+=1440),t<A&&s>P})&&(i.value=`⚠️ ${c("err_schedule_conflict","Jadwal bentrok!")}`)};M(()=>[a.start_time,a.end_time],m);const _=()=>{if(!a.title||a.title.trim()==="")return w(c("warn_empty_title","Judulnya diisi dulu, Bro!"));if(h.value==="full"){if(!a.start_time||!a.end_time)return w(c("warn_empty_time","Tentukan jam mulai & selesai!"));if(m(),i.value)return}else a.start_time=null,a.end_time=null;const t={...a.data()};if(e.value=!1,D(c("success_saved","Tersimpan!")),f.value){const s=l.value.findIndex(p=>p.id===a.id);s!==-1&&(l.value[s]={...l.value[s],...t}),R.patch(route("planner.update",a.id),t,{preserveScroll:!0,preserveState:!0,progress:!1,only:["tasks","errors"],onFinish:()=>a.reset()})}else{const s="temp_"+Date.now();l.value.push({...t,id:s,is_completed:!1}),R.post(route("planner.store"),t,{preserveScroll:!0,preserveState:!0,progress:!1,only:["tasks","errors"],onError:()=>{l.value=l.value.filter(p=>p.id!==s),g(c("err_save_failed","Gagal menyimpan ke server!"))},onFinish:()=>a.reset()})}},y=t=>{l.value=l.value.filter(s=>s.id!==t),e.value=!1,D(c("success_deleted","Dihapus!")),R.delete(route("planner.destroy",t),{preserveScroll:!0,preserveState:!0,progress:!1,only:["tasks","errors"],onError:()=>{g(c("err_delete_failed","Gagal menghapus data!"))}})},k=t=>{t.is_completed=!t.is_completed,R.patch(route("planner.toggle",{plannerTask:t.id}),{},{preserveScroll:!0,preserveState:!0,progress:!1,only:["tasks","errors"]})};M(()=>n.tasks,t=>{l.value=[...t]},{deep:!0});const r=N(()=>l.value.filter(t=>t.start_time).sort((t,s)=>t.start_time.localeCompare(s.start_time))),v=N(()=>l.value.filter(t=>!t.start_time)),x=t=>{const s=t.length,p=t.filter(C=>C.is_completed).length;return{total:s,completed:p,percent:s>0?Math.round(p/s*100):0}},b=N(()=>x(r.value)),Y=N(()=>x(v.value));return{localTasks:l,scheduledTasks:r,inboxTasks:v,scheduledStats:b,inboxStats:Y,form:a,isModalOpen:e,isEditing:f,activeModalType:h,conflictError:i,openModal:(t=null,s=null,p="full")=>{if(a.reset(),a.clearErrors(),i.value=null,h.value=p,t)f.value=!0,a.id=t.id,a.date=t.date||n.currentDate,a.title=t.title,a.start_time=t.start_time,a.end_time=t.end_time,a.type=t.type,a.notes=t.notes||"";else if(f.value=!1,a.id=null,a.date=n.currentDate,s){a.start_time=s;const[C,B]=s.split(":").map(Number);a.end_time=`${(C+1).toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}`}e.value=!0},submitTask:_,deleteTask:y,toggleComplete:k}}function nt(n){return{onDragStart:(e,f)=>{e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("taskId",f.id)},onDrop:async(e,f)=>{const h=parseInt(e.dataTransfer.getData("taskId")),a=n.value.find(c=>c.id===h);if(a){a.start_time=f,a.end_time=null;try{await U.patch(route("planner.update",h),{start_time:f,end_time:null})}catch(c){console.error("Gagal update timeline:",c)}}}}}const it=(n,l)=>{let i;return(...e)=>{clearTimeout(i),i=setTimeout(()=>n(...e),l)}};function ct(n){var m,_,y,k;const l=lt(n),i=nt(l.localTasks),e=S(((m=n.dailyLog)==null?void 0:m.notes)||""),f=S(((_=n.dailyLog)==null?void 0:_.meals)||{breakfast:"",lunch:"",dinner:""}),h=S(((y=n.dailyLog)==null?void 0:y.water)||0),a=S(((k=n.dailyLog)==null?void 0:k.task_box)||[]),c=S("full"),u=it(async r=>{try{await U.post(route("planner.updateLog"),{...r,date:n.currentDate})}catch(v){console.error("Auto-save failed:",v)}},1e3);M(e,r=>u({notes:r})),M(f,r=>u({meals:r}),{deep:!0}),M(h,r=>u({water:r})),M(a,r=>u({task_box:r}),{deep:!0}),M(()=>n.dailyLog,r=>{e.value=(r==null?void 0:r.notes)||"",f.value=(r==null?void 0:r.meals)||{breakfast:"",lunch:"",dinner:""},h.value=(r==null?void 0:r.water)||0,a.value=(r==null?void 0:r.task_box)||[]},{deep:!0});const w=Array.from({length:18},(r,v)=>`${(v+6).toString().padStart(2,"0")}:00`);return{...l,...i,openModal:(r=null,v=null,x="full")=>{c.value=x,l.openModal(r,v)},activeModalType:c,resetBoard:()=>{O.fire({title:"Hapus Semua Jadwal?",text:"Aksi ini akan menghapus semua jadwal di tanggal ini saja!",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Bersihkan!",cancelButtonText:"Batal",buttonsStyling:!1,customClass:{popup:"rounded-[2.5rem] p-8 border border-slate-100 shadow-2xl",title:"text-2xl font-black text-slate-800 mb-2 font-sans",htmlContainer:"text-sm text-slate-500 font-bold mb-4",confirmButton:"bg-rose-500 text-white font-black py-4 px-8 rounded-2xl shadow-xl shadow-rose-200 active:scale-95 transition-all mx-2",cancelButton:"bg-slate-100 text-slate-400 font-black py-4 px-8 rounded-2xl hover:bg-slate-200 active:scale-95 transition-all mx-2",actions:"mt-6 gap-2"}}).then(r=>{r.isConfirmed&&(e.value="",f.value={breakfast:"",lunch:"",dinner:""},h.value=0,a.value=[],l.localTasks.value=[],R.post(route("planner.reset"),{date:n.currentDate},{preserveScroll:!0,onSuccess:()=>{window.dispatchEvent(new Event("reset-local-storage")),O.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,background:"#4f46e5",iconColor:"#ffffff",icon:"success",title:'<span style="color: white; font-weight: 900;">Jadwal Direset!</span>',customClass:{container:"!fixed !top-5 !right-5 !z-[100000]",popup:"!rounded-full !shadow-2xl"}})}}))})},timeSlots:w,getTypeColor:r=>({1:"bg-rose-50 text-rose-700 border-rose-200",2:"bg-indigo-50 text-indigo-700 border-indigo-200",3:"bg-emerald-50 text-emerald-700 border-emerald-200"})[r]||"bg-white text-slate-700 border-slate-200",localNotes:e,localMeals:f,localWater:h,localTaskBox:a}}function ut(n){const l=S(!1),i=S(null),e=z({date:n.value,tasks:[{title:"",start_time:"08:00",end_time:"09:00",type:1,notes:""}]}),f=()=>{e.reset(),e.date=n.value,e.tasks=[{title:"",start_time:"08:00",end_time:"09:00",type:1,notes:""}],e.clearErrors(),i.value=null,l.value=!0},h=()=>{l.value=!1,e.reset(),e.clearErrors(),i.value=null},a=()=>{const g=e.tasks[e.tasks.length-1];let d="09:00";g&&g.end_time&&(d=g.end_time);let[m,_]=d.split(":").map(Number),k=`${((m+1)%24).toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`;e.tasks.push({title:"",start_time:d,end_time:k,type:1,notes:""})},c=g=>{e.tasks.length>1&&e.tasks.splice(g,1)},u=g=>{if(!g)return 0;const[d,m]=g.split(":").map(Number);return d*60+m},w=()=>{e.clearErrors(),i.value=null;const g=J().props.tasks||[];let d=!0;if(e.tasks.forEach((m,_)=>{m.title||(e.setError(`tasks.${_}.title`,"Required"),d=!1);const y=u(m.start_time);let k=u(m.end_time);k<y&&(k+=1440),k-y<15&&(e.setError(`tasks.${_}.end_time`,"Min 15 mins"),i.value=`Row ${_+1}: Duration must be at least 15 minutes!`,d=!1),g.some(v=>{if(!v.start_time||!v.end_time)return!1;const x=u(v.start_time);let b=u(v.end_time);return b<x&&(b+=1440),y<b&&k>x})&&(i.value=`Row ${_+1}: Clashes with an existing schedule!`,e.setError(`tasks.${_}.start_time`,"Clash!"),d=!1)}),!d)return!1;for(let m=0;m<e.tasks.length;m++){const _=e.tasks[m],y=u(_.start_time);let k=u(_.end_time);k<y&&(k+=1440);for(let r=m+1;r<e.tasks.length;r++){const v=e.tasks[r],x=u(v.start_time);let b=u(v.end_time);b<x&&(b+=1440),y<b&&k>x&&(i.value=`Row ${m+1} and Row ${r+1} are overlapping!`,e.setError(`tasks.${m}.start_time`,"Overlap"),e.setError(`tasks.${r}.start_time`,"Overlap"),d=!1)}}return d};return{isBatchModalOpen:l,batchForm:e,globalConflictError:i,openBatchModal:f,closeBatchModal:h,addBatchRow:a,removeBatchRow:c,submitBatch:()=>{w()&&(e.date=n.value,e.post(route("planner.batchStore"),{preserveScroll:!0,preserveState:!0,progress:!1,only:["tasks","errors"],onSuccess:()=>{h(),O.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,background:"#4f46e5",iconColor:"#ffffff",icon:"success",title:'<span style="color: white; font-weight: 900; font-size: 14px;">Batch Saved Successfully!</span>',customClass:{popup:"!rounded-full"}})},onError:g=>{console.error("Batch Error",g)}}))}}}function dt(n){const l=J(),i=S(n),e=N(()=>(l.props.locale||"id").split("-")[0]),f=N(()=>W(i.value).locale(e.value).format("DD MMMM YYYY")),h=c=>{i.value=c,R.get(route("planner.index"),{date:c},{preserveState:!0,preserveScroll:!0,replace:!0,only:["tasks","dailyLog","currentDate"]})};return{currentDate:i,formattedDate:f,changeDate:h,changeDay:c=>{const u=W(i.value),w=c==="next"?u.add(1,"day").format("YYYY-MM-DD"):u.subtract(1,"day").format("YYYY-MM-DD");h(w)}}}const mt={class:"w-full min-h-screen bg-slate-50/50 px-4 sm:px-6 lg:px-8 py-8"},ft={class:"grid grid-cols-1 lg:grid-cols-5 gap-8 items-start"},pt={class:"lg:col-span-3 order-1 lg:order-2 w-full"},ht={class:"lg:col-span-2 order-2 lg:order-1 w-full space-y-6 md:sticky md:top-24"},Yt=Object.assign({layout:tt},{__name:"Index",props:{tasks:Array,dailyLog:Object,currentDate:String},setup(n){const l=n,{currentDate:i,formattedDate:e,changeDate:f,changeDay:h}=dt(l.currentDate),{scheduledTasks:a,timeSlots:c,scheduledStats:u,form:w,isModalOpen:D,isEditing:g,openModal:d,submitTask:m,deleteTask:_,resetBoard:y,toggleComplete:k,onDragStart:r,onDrop:v,getTypeColor:x,localNotes:b,localMeals:Y,conflictError:F,localWater:t,localTaskBox:s}=ct(l),{isBatchModalOpen:p,batchForm:C,openBatchModal:B,addBatchRow:P,removeBatchRow:A,submitBatch:V}=ut(i),G=()=>{D.value=!1,B()},H=()=>{p.value=!1,d()},q=()=>{y(),window.dispatchEvent(new Event("reset-local-storage"))};return(vt,T)=>(L(),Z(X,null,[$(o(K),{title:"Daily Planner"}),$(et,{currentDate:o(i),formattedDate:o(e),tasks:n.tasks,onChangeDate:o(f),onChangeDay:o(h),openModal:()=>o(d)(null,null,"full"),resetBoard:q,stats:o(u)},null,8,["currentDate","formattedDate","tasks","onChangeDate","onChangeDay","openModal","stats"]),j("div",mt,[j("div",ft,[j("div",pt,[$(rt,{timeSlots:o(c),scheduledTasks:o(a),onDrop:o(v),onDragStart:o(r),openModal:o(d),toggleComplete:o(k),getTypeColor:o(x)},null,8,["timeSlots","scheduledTasks","onDrop","onDragStart","openModal","toggleComplete","getTypeColor"])]),j("div",ht,[$(at,{stats:o(u),localNotes:o(b),"onUpdate:localNotes":T[0]||(T[0]=E=>I(b)?b.value=E:null),localMeals:o(Y),"onUpdate:localMeals":T[1]||(T[1]=E=>I(Y)?Y.value=E:null),localWater:o(t),"onUpdate:localWater":T[2]||(T[2]=E=>I(t)?t.value=E:null),localTaskBox:o(s),"onUpdate:localTaskBox":T[3]||(T[3]=E=>I(s)?s.value=E:null)},null,8,["stats","localNotes","localMeals","localWater","localTaskBox"])])])]),$(st,{show:o(D),form:o(w),isEditing:o(g),conflictError:o(F),close:()=>D.value=!1,submit:o(m),remove:o(_),onSwitchToBatch:G},null,8,["show","form","isEditing","conflictError","close","submit","remove"]),$(ot,{show:o(p),form:o(C),conflictError:o(F),close:()=>p.value=!1,submit:o(V),addRow:o(P),removeRow:o(A),switchToSingle:H},null,8,["show","form","conflictError","close","submit","addRow","removeRow"])],64))}});export{Yt as default};
