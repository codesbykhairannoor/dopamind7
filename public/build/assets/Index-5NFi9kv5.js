import{z as f,x as C,b as x,Q as E,a1 as j,y as w,A as B,a as V,T as J,d as K,e as Y,f as $,u as t,Z as R,o as U}from"./vendor-BNleA0cf.js";import{_ as z}from"./AuthenticatedLayout-C9pBm3K_.js";import Z from"./HabitHeader-it86dFik.js";import q from"./HabitGrid-joweDtqw.js";import W from"./HabitStats-Du5x1jvL.js";import X from"./HabitModals-BgfFC8r0.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";f.extend(j);function ee(n){const s=f().locale("id").format("dddd, D MMMM YYYY"),c=C(()=>{const i=E().props.locale||"id";f.locale(i);const d=n.monthQuery?f(n.monthQuery):f(),r=d.daysInMonth();let b=[];for(let p=1;p<=r;p++){const g=d.date(p);b.push({dateString:g.format("YYYY-MM-DD"),dayNumber:p,dayName:g.format("ddd"),isToday:g.isSame(f(),"day"),isFuture:g.isAfter(f(),"day")})}return b});return{todayDate:s,monthDates:c,changeMonth:i=>{let d;if(i==="next"||i==="prev"){const r=n.monthQuery?f(n.monthQuery):f();d=i==="next"?r.add(1,"month").format("YYYY-MM"):r.subtract(1,"month").format("YYYY-MM")}else d=i;x.get(route("habits.index"),{month:d},{preserveState:!1,preserveScroll:!0})}}}function te(n){const s=E().props.auth.user,c=w(JSON.parse(JSON.stringify(n.habits.data)));B(()=>n.habits,e=>{c.value=JSON.parse(JSON.stringify(e.data))},{deep:!0});const M=C(()=>{const e=f().hour();return e<11?"greet_morning":e<15?"greet_noon":e<19?"greet_afternoon":"greet_night"}),i=C(()=>{if(c.value.length===0)return 0;const e=f().format("YYYY-MM-DD");let a=0;return c.value.forEach(h=>{h.logs&&h.logs[e]==="completed"&&a++}),Math.round(a/c.value.length*100)}),d=C(()=>{let e=0;return c.value.forEach(a=>e+=a.progress_count),e}),r=C(()=>{if(c.value.length===0)return 0;let e=0;return c.value.forEach(a=>e+=a.progress_percent),Math.round(e/c.value.length)}),b=(e,a)=>e.logs&&e.logs[a]?e.logs[a]:"empty",p=async(e,a,h=null)=>{if(f(a).isAfter(f(),"day"))return;const _=c.value.findIndex(u=>u.id===e);if(_===-1)return;const m=c.value[_],o=m.logs[a]||"empty";let l="completed";h?l=o===h?"uncheck":h:l=o==="completed"||o==="skipped"?"uncheck":"completed",l==="uncheck"?delete m.logs[a]:m.logs[a]=l;const v=Object.values(m.logs).filter(u=>u==="completed").length;m.progress_count=v,m.progress_percent=m.monthly_target>0?Math.min(100,Math.round(v/m.monthly_target*100)):0;try{await V.post(route("habits.log",e),{date:a,status:l})}catch(u){console.error("Gagal save:",u)}},g=(e,a,h,_,m)=>{const o=e.key;if(o===" "){e.preventDefault(),p(_,m);return}if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(o))return;e.preventDefault();let l=a,v=h;o==="ArrowUp"&&l--,o==="ArrowDown"&&l++,o==="ArrowLeft"&&v--,o==="ArrowRight"&&v++;const u=`cell-${l}-${v}`,H=document.getElementById(u);H&&(H.focus(),H.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"}))},D=[{code:"fire",icon:"ðŸ”¥",label_key:"mood_fire",color:"bg-amber-100 text-amber-600"},{code:"happy",icon:"ðŸ˜„",label_key:"mood_happy",color:"bg-emerald-100 text-emerald-600"},{code:"neutral",icon:"ðŸ˜",label_key:"mood_neutral",color:"bg-slate-100 text-slate-600"},{code:"sad",icon:"ðŸ˜¢",label_key:"mood_sad",color:"bg-blue-100 text-blue-600"},{code:"stress",icon:"ðŸ¤¯",label_key:"mood_stress",color:"bg-rose-100 text-rose-600"},{code:"sick",icon:"ðŸ¤’",label_key:"mood_sick",color:"bg-purple-100 text-purple-600"}],y=w(!1),S=C(()=>n.savedMood&&D.find(e=>e.code===n.savedMood)||D[0]);return{user:s,localHabits:c,greetingKey:M,todayProgress:i,totalCompletions:d,overallPercentage:r,getStatus:b,toggleStatus:p,handleGridNav:g,moodOptions:D,showMoodDropdown:y,currentMoodData:S,selectMood:e=>{y.value=!1,x.post(route("habits.mood"),{mood_code:e,period:n.monthQuery},{preserveScroll:!0})}}}function oe(n,s){const c=["ðŸ”¥","ðŸ’§","ðŸƒâ€â™‚ï¸","ðŸ“š","ðŸ§˜â€â™‚ï¸","ðŸ’»","ðŸ’°","ðŸ’Š","ðŸ¥¦","ðŸ’¤","ðŸ§¹","ðŸŽ¸","ðŸŽ¨","ðŸ¶","ðŸŽ“","âš¡","ðŸš«","ðŸ¥—","ðŸ‹ï¸","ðŸš´","ðŸ¤²","ðŸ•Œ","âœˆï¸","ðŸŽµ"],M=["#ef4444","#f97316","#f59e0b","#10b981","#06b6d4","3b82f6","#6366f1","#d946ef","#8b5cf6","#64748b"],i=w(!1),d=w(!1),r=J({id:null,name:"",icon:"âš¡",color:"#6366f1",monthly_target:20,period:n.monthQuery}),b=o=>{d.value=!0,i.value=!0,r.id=o.id,r.name=o.name,r.icon=o.icon,r.color=o.color,r.monthly_target=o.monthly_target},p=()=>{d.value=!1,r.reset(),r.id=null,i.value=!0},g=()=>{i.value=!1,y.value=!1,e.value=!1,setTimeout(()=>{d.value=!1,r.reset(),r.id=null},300)},D=()=>{const o={...r.data(),period:n.monthQuery};if(d.value){const l=s.value.findIndex(u=>u.id===r.id);l!==-1&&Object.assign(s.value[l],o);const v=r.id;g(),x.patch(route("habits.update",v),o,{preserveScroll:!0,preserveState:!0,onError:u=>console.error(u)})}else{const l="temp_"+Date.now();s.value.push({...o,id:l,logs:[],completed_count:0}),g(),x.post(route("habits.store"),o,{preserveScroll:!0,onSuccess:()=>{},onError:v=>{s.value=s.value.filter(u=>u.id!==l),alert("Gagal menyimpan habit.")}})}},y=w(!1),S=()=>{y.value=!0},k=()=>{y.value=!1,x.post(route("habits.copy"),{current_period:n.monthQuery,prev_period:n.prevMonthQuery},{preserveScroll:!0})},e=w(!1),a=w(null),h=o=>{a.value=o,e.value=!0};return{iconList:c,colorPalette:M,form:r,showCreateModal:i,isEditing:d,editHabit:b,openCreateModal:p,closeModal:g,submitHabit:D,showCopyModal:y,openCopyModal:S,executeCopy:k,showDeleteModal:e,habitToDelete:a,confirmDelete:h,executeDelete:()=>{if(!a.value)return;const o=a.value.id;s.value=s.value.filter(l=>l.id!==o),e.value=!1,a.value=null,x.delete(route("habits.destroy",o),{preserveScroll:!0,preserveState:!0,onError:()=>alert("Gagal menghapus habit.")})},deleteFromEdit:()=>{i.value=!1;const o=s.value.find(l=>l.id===r.id);setTimeout(()=>{o&&h(o)},200)}}}function ae(n){const s=ee(n),c=te(n),M=oe(n,c.localHabits);return{...s,...c,...M}}const re={class:"min-h-screen bg-slate-50/50"},ne={class:"space-y-6 pb-12"},ge=Object.assign({layout:z},{__name:"Index",props:{habits:Object,currentMonth:String,monthQuery:String,hasPrevHabits:Boolean,prevMonthQuery:String,savedMood:String},setup(n){const s=n,{user:c,localHabits:M,showCreateModal:i,isEditing:d,todayDate:r,greetingKey:b,iconList:p,colorPalette:g,form:D,monthDates:y,todayProgress:S,totalCompletions:k,overallPercentage:e,changeMonth:a,getStatus:h,toggleStatus:_,openCreateModal:m,editHabit:o,closeModal:l,submitHabit:v,showDeleteModal:u,habitToDelete:H,confirmDelete:P,executeDelete:N,deleteFromEdit:Q,showCopyModal:O,openCopyModal:A,executeCopy:I,handleGridNav:L,moodOptions:T,currentMoodData:G,selectMood:F}=ae(s);return(le,se)=>(U(),K("div",re,[Y(t(R),{title:"Habit Tracker"}),$("div",ne,[Y(Z,{user:t(c),greetingKey:t(b),todayDate:t(r),currentMonth:s.currentMonth,currentMonthValue:s.monthQuery,todayProgress:t(S),changeMonth:t(a),openCreateModal:t(m)},null,8,["user","greetingKey","todayDate","currentMonth","currentMonthValue","todayProgress","changeMonth","openCreateModal"]),Y(q,{localHabits:t(M),monthDates:t(y),hasPrevHabits:s.hasPrevHabits,toggleStatus:t(_),handleGridNav:t(L),getStatus:t(h),editHabit:t(o),confirmDelete:t(P),openCreateModal:t(m),openCopyModal:t(A)},null,8,["localHabits","monthDates","hasPrevHabits","toggleStatus","handleGridNav","getStatus","editHabit","confirmDelete","openCreateModal","openCopyModal"]),Y(W,{localHabits:t(M),overallPercentage:t(e),totalCompletions:t(k),currentMoodData:t(G),moodOptions:t(T),savedMood:s.savedMood,selectMood:t(F)},null,8,["localHabits","overallPercentage","totalCompletions","currentMoodData","moodOptions","savedMood","selectMood"]),Y(X,{showDeleteModal:t(u),showCopyModal:t(O),showCreateModal:t(i),isEditing:t(d),form:t(D),habitToDelete:t(H),iconList:t(p),colorPalette:t(g),closeModal:t(l),submitHabit:t(v),executeDelete:t(N),executeCopy:t(I),deleteFromEdit:t(Q)},null,8,["showDeleteModal","showCopyModal","showCreateModal","isEditing","form","habitToDelete","iconList","colorPalette","closeModal","submitHabit","executeDelete","executeCopy","deleteFromEdit"])])]))}});export{ge as default};
