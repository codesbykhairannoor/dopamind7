import{r as T,T as j,q as N,p as D,t as V,Q as z,a as G,b as y,u as n,Z as H,w as q,d as R,K as O,F as U,o as K}from"./vendor-vue-CkFWKx2i.js";import{_ as Q}from"./AuthenticatedLayout-CcwI3zy0.js";import{S as F,a as J}from"./vendor-utils-2VVJO3Sv.js";import{N as C}from"./vendor-inertia-CzGZ5YH6.js";import W from"./PlannerHeader-DhU9nUK7.js";import Y from"./PlannerSidebar-DihZJ5fs.js";import Z from"./PlannerTimeline-DBptlasg.js";import X from"./PlannerModal-C7qXsZIC.js";import tt from"./PlannerBatchModal-8N-ZARPG.js";import"./vendor-core-Dt3pqkYV.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-BPGVzs3g.js";import"./InputLabel-lXEog0Bg.js";import"./TextInput-CywluzKN.js";import"./PrimaryButton-zlRmh2oL.js";import"./SecondaryButton-QY6waUcz.js";function et(h){const o=T([...h.tasks]),s=T(null),c=T(!1),u=T(!1),w=T("full"),e=j({id:null,title:"",start_time:null,end_time:null,type:1,notes:""}),l=(t,a)=>{const f=V(t);return f!==t?f:a},S=(t,a,f="#4f46e5")=>{F.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,background:f,iconColor:"#ffffff",icon:t,title:`<span style="color: white; font-weight: 900; font-size: 14px;">${a}</span>`,customClass:{container:"!fixed !top-5 !right-5 !p-0 !z-[100000] !items-start !justify-end",popup:"!flex !items-center !gap-3 !py-3 !px-6 !rounded-full !shadow-2xl !border-none !w-auto !h-auto !min-w-[280px] !m-0"}})},E=t=>S("warning",t,"#4f46e5"),m=t=>S("success",t,"#4f46e5"),d=t=>S("error",t,"#4f46e5"),i=t=>{if(!t)return 0;const[a,f]=t.split(":").map(Number);return a*60+f},r=()=>{if(s.value=null,!e.start_time||!e.end_time)return;const t=i(e.start_time);let a=i(e.end_time);if(a<t&&(a+=1440),a-t<15){s.value=`⛔ ${l("err_min_15_mins","Minimal 15 menit!")}`;return}o.value.some(x=>{if(u.value&&x.id===e.id||!x.start_time)return!1;const $=i(x.start_time);let B=x.end_time?i(x.end_time):$+60;return B<$&&(B+=1440),t<B&&a>$})&&(s.value=`⚠️ ${l("err_schedule_conflict","Jadwal bentrok!")}`)};N(()=>[e.start_time,e.end_time],r);const p=()=>{if(!e.title||e.title.trim()==="")return E(l("warn_empty_title","Judulnya diisi dulu, Bro!"));if(w.value==="full"){if(!e.start_time||!e.end_time)return E(l("warn_empty_time","Tentukan jam mulai & selesai!"));if(r(),s.value)return}else e.start_time=null,e.end_time=null;const t={...e.data()};if(c.value=!1,m(l("success_saved","Tersimpan!")),u.value){const a=o.value.findIndex(f=>f.id===e.id);a!==-1&&(o.value[a]={...o.value[a],...t}),C.patch(route("planner.update",e.id),t,{preserveScroll:!0,onFinish:()=>e.reset()})}else{const a="temp_"+Date.now();o.value.push({...t,id:a,is_completed:!1}),C.post(route("planner.store"),t,{preserveScroll:!0,onError:()=>{o.value=o.value.filter(f=>f.id!==a),d(l("err_save_failed","Gagal menyimpan ke server!"))},onFinish:()=>e.reset()})}},_=t=>{o.value=o.value.filter(a=>a.id!==t),c.value=!1,m(l("success_deleted","Dihapus!")),C.delete(route("planner.destroy",t),{preserveScroll:!0,onError:()=>{d(l("err_delete_failed","Gagal menghapus data!"))}})},b=t=>{t.is_completed=!t.is_completed,C.patch(route("planner.toggle",{plannerTask:t.id}),{},{preserveScroll:!0,preserveState:!0})};N(()=>h.tasks,t=>{o.value=[...t]},{deep:!0});const g=D(()=>o.value.filter(t=>t.start_time).sort((t,a)=>t.start_time.localeCompare(a.start_time))),k=D(()=>o.value.filter(t=>!t.start_time)),v=t=>{const a=t.length,f=t.filter(M=>M.is_completed).length;return{total:a,completed:f,percent:a>0?Math.round(f/a*100):0}},P=D(()=>v(g.value)),A=D(()=>v(k.value));return{localTasks:o,scheduledTasks:g,inboxTasks:k,scheduledStats:P,inboxStats:A,form:e,isModalOpen:c,isEditing:u,activeModalType:w,conflictError:s,openModal:(t=null,a=null,f="full")=>{if(e.reset(),e.clearErrors(),s.value=null,w.value=f,t)u.value=!0,e.id=t.id,e.title=t.title,e.start_time=t.start_time,e.end_time=t.end_time,e.type=t.type,e.notes=t.notes||"";else if(u.value=!1,e.id=null,a){e.start_time=a;const[M,x]=a.split(":").map(Number);e.end_time=`${(M+1).toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`}c.value=!0},submitTask:p,deleteTask:_,toggleComplete:b}}function st(h){return{onDragStart:(c,u)=>{c.dataTransfer.dropEffect="move",c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("taskId",u.id)},onDrop:async(c,u)=>{const w=parseInt(c.dataTransfer.getData("taskId")),e=h.value.find(l=>l.id===w);if(e){e.start_time=u,e.end_time=null;try{await J.patch(route("planner.update",w),{start_time:u,end_time:null})}catch(l){console.error("Gagal update timeline:",l)}}}}}const ot=(h,o)=>{let s;return(...c)=>{clearTimeout(s),s=setTimeout(()=>h(...c),o)}};function at(h){var d,i;const o=et(h),s=st(o.localTasks),c=T(((d=h.dailyLog)==null?void 0:d.notes)||""),u=T(((i=h.dailyLog)==null?void 0:i.meals)||{breakfast:"",lunch:"",dinner:""}),w=T("full"),e=ot(async r=>{try{await J.post(route("planner.updateLog"),r)}catch(p){console.error("Auto-save failed:",p)}},1e3);N(c,r=>e({notes:r})),N(u,r=>e({meals:r}),{deep:!0});const l=Array.from({length:18},(r,p)=>`${(p+6).toString().padStart(2,"0")}:00`);return{...o,...s,openModal:(r=null,p=null,_="full")=>{w.value=_,o.openModal(r,p)},activeModalType:w,resetBoard:()=>{F.fire({title:"Hapus Semua Jadwal?",text:"Aksi ini tidak bisa dibatalkan, Bro!",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Bersihkan!",cancelButtonText:"Batal",buttonsStyling:!1,customClass:{popup:"rounded-[2.5rem] p-8 border border-slate-100 shadow-2xl",title:"text-2xl font-black text-slate-800 mb-2 font-sans",htmlContainer:"text-sm text-slate-500 font-bold mb-4",confirmButton:"bg-rose-500 text-white font-black py-4 px-8 rounded-2xl shadow-xl shadow-rose-200 active:scale-95 transition-all mx-2",cancelButton:"bg-slate-100 text-slate-400 font-black py-4 px-8 rounded-2xl hover:bg-slate-200 active:scale-95 transition-all mx-2",actions:"mt-6 gap-2"}}).then(r=>{r.isConfirmed&&(c.value="",u.value={breakfast:"",lunch:"",dinner:""},o.localTasks.value=[],C.post(route("planner.reset"),{},{preserveScroll:!0,onSuccess:()=>{window.dispatchEvent(new Event("reset-local-storage")),F.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,background:"#4f46e5",iconColor:"#ffffff",icon:"success",title:'<span style="color: white; font-weight: 900;">Jadwal Direset!</span>',customClass:{container:"!fixed !top-5 !right-5 !z-[100000]",popup:"!rounded-full !shadow-2xl"}})}}))})},timeSlots:l,getTypeColor:r=>({1:"bg-rose-50 text-rose-700 border-rose-200",2:"bg-indigo-50 text-indigo-700 border-indigo-200",3:"bg-emerald-50 text-emerald-700 border-emerald-200"})[r]||"bg-white text-slate-700 border-slate-200",localNotes:c,localMeals:u}}function rt(){const h=T(!1),o=T(null),s=j({tasks:[{title:"",start_time:"08:00",end_time:"09:00",type:1,notes:""}]}),c=()=>{s.reset(),s.tasks=[{title:"",start_time:"08:00",end_time:"09:00",type:1,notes:""}],s.clearErrors(),o.value=null,h.value=!0},u=()=>{h.value=!1,s.reset(),s.clearErrors(),o.value=null},w=()=>{const m=s.tasks[s.tasks.length-1];let d="09:00";m&&m.end_time&&(d=m.end_time);let[i,r]=d.split(":").map(Number),_=`${((i+1)%24).toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`;s.tasks.push({title:"",start_time:d,end_time:_,type:1,notes:""})},e=m=>{s.tasks.length>1&&s.tasks.splice(m,1)},l=m=>{if(!m)return 0;const[d,i]=m.split(":").map(Number);return d*60+i},S=()=>{s.clearErrors(),o.value=null;const m=z().props.tasks||[];let d=!0;if(s.tasks.forEach((i,r)=>{i.title||(s.setError(`tasks.${r}.title`,"Required"),d=!1);const p=l(i.start_time);let _=l(i.end_time);_<p&&(_+=1440),_-p<15&&(s.setError(`tasks.${r}.end_time`,"Min 15 mins"),o.value=`Row ${r+1}: Duration must be at least 15 minutes!`,d=!1),m.some(g=>{if(!g.start_time||!g.end_time)return!1;const k=l(g.start_time);let v=l(g.end_time);return v<k&&(v+=1440),p<v&&_>k})&&(o.value=`Row ${r+1}: Clashes with an existing schedule!`,s.setError(`tasks.${r}.start_time`,"Clash!"),d=!1)}),!d)return!1;for(let i=0;i<s.tasks.length;i++){const r=s.tasks[i],p=l(r.start_time);let _=l(r.end_time);_<p&&(_+=1440);for(let b=i+1;b<s.tasks.length;b++){const g=s.tasks[b],k=l(g.start_time);let v=l(g.end_time);v<k&&(v+=1440),p<v&&_>k&&(o.value=`Row ${i+1} and Row ${b+1} are overlapping!`,s.setError(`tasks.${i}.start_time`,"Overlap"),s.setError(`tasks.${b}.start_time`,"Overlap"),d=!1)}}return d};return{isBatchModalOpen:h,batchForm:s,globalConflictError:o,openBatchModal:c,closeBatchModal:u,addBatchRow:w,removeBatchRow:e,submitBatch:()=>{S()&&s.post(route("planner.batchStore"),{preserveScroll:!0,onSuccess:()=>{u()},onError:m=>{console.error("Batch Error",m)}})}}}const lt={class:"w-full min-h-screen bg-slate-50/50 px-4 sm:px-6 lg:px-8 py-8"},nt={class:"grid grid-cols-1 lg:grid-cols-5 gap-8 items-start"},it={class:"lg:col-span-3 order-1 lg:order-2 w-full"},ct={class:"lg:col-span-2 order-2 lg:order-1 w-full space-y-6 md:sticky md:top-24"},yt={__name:"Index",props:{tasks:Array,dailyLog:Object},setup(h){const o=h,{scheduledTasks:s,timeSlots:c,scheduledStats:u,form:w,isModalOpen:e,isEditing:l,openModal:S,submitTask:E,deleteTask:m,resetBoard:d,toggleComplete:i,onDragStart:r,onDrop:p,getTypeColor:_,localNotes:b,localMeals:g,conflictError:k}=at(o),{isBatchModalOpen:v,batchForm:P,openBatchModal:A,addBatchRow:L,removeBatchRow:t,submitBatch:a}=rt(),f=()=>{e.value=!1,A()},M=()=>{v.value=!1,S()},x=()=>{d(),window.dispatchEvent(new Event("reset-local-storage"))};return($,B)=>(K(),G(U,null,[y(n(H),{title:"Daily Planner"}),y(Q,null,{default:q(()=>[y(W,{openModal:()=>n(S)(null,null,"full"),resetBoard:x,stats:n(u)},null,8,["openModal","stats"]),R("div",lt,[R("div",nt,[R("div",it,[y(Z,{timeSlots:n(c),scheduledTasks:n(s),onDrop:n(p),onDragStart:n(r),openModal:n(S),toggleComplete:n(i),getTypeColor:n(_)},null,8,["timeSlots","scheduledTasks","onDrop","onDragStart","openModal","toggleComplete","getTypeColor"])]),R("div",ct,[y(Y,{stats:n(u),localNotes:n(b),"onUpdate:localNotes":B[0]||(B[0]=I=>O(b)?b.value=I:null),localMeals:n(g),"onUpdate:localMeals":B[1]||(B[1]=I=>O(g)?g.value=I:null)},null,8,["stats","localNotes","localMeals"])])])]),y(X,{show:n(e),form:n(w),isEditing:n(l),conflictError:n(k),close:()=>e.value=!1,submit:n(E),remove:n(m),onSwitchToBatch:f},null,8,["show","form","isEditing","conflictError","close","submit","remove"]),y(tt,{show:n(v),form:n(P),conflictError:n(k),close:()=>v.value=!1,submit:n(a),addRow:n(L),removeRow:n(t),switchToSingle:M},null,8,["show","form","conflictError","close","submit","addRow","removeRow"])]),_:1})],64))}};export{yt as default};
