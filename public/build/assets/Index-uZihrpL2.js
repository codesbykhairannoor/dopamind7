import{r as k,T as F,k as N,h as D,N as C,E as L,Q as J,c as V,a as B,u as r,Z as z,w as H,b as R,R as I,F as G,o as U}from"./app-DBmEpP_-.js";import{_ as q}from"./AuthenticatedLayout-D0uvWJ6p.js";import{S as A}from"./sweetalert2.esm.all-AlKuj1Cq.js";import Q from"./PlannerHeader-DHHkyuFj.js";import W from"./PlannerSidebar-C_BRd72O.js";import Y from"./PlannerTimeline-BmnwPkHc.js";import Z from"./PlannerModal-DvnvbmKQ.js";import K from"./PlannerBatchModal-B-Jkz2rV.js";import"./dayjs.min-Z4LNoRjb.js";import"./en-B63u2pIa.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-CtEAoQmQ.js";import"./InputLabel-ClMRtDTm.js";import"./TextInput-B-i4niCk.js";import"./PrimaryButton-ntd1E3Ya.js";import"./SecondaryButton-BlnJah4L.js";function X(h){const a=k([...h.tasks]),o=k(null),i=k(!1),c=k(!1),g=k("full"),e=F({id:null,title:"",start_time:null,end_time:null,type:1,notes:""}),u=t=>{A.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,background:"#4f46e5",iconColor:"#ffffff",icon:"warning",title:`<span style="color: white; font-weight: 900; font-size: 14px;">${t}</span>`,customClass:{container:"!fixed !top-5 !right-5 !p-0 !z-[100000] !items-start !justify-end",popup:"!flex !items-center !gap-3 !py-3 !px-6 !rounded-full !shadow-2xl !border-none !w-auto !h-auto !min-w-[280px] !m-0"}})},b=t=>{if(!t)return 0;const[l,_]=t.split(":").map(Number);return l*60+_},T=()=>{if(o.value=null,!e.start_time||!e.end_time)return;const t=b(e.start_time);let l=b(e.end_time);if(l<t&&(l+=1440),l-t<15){o.value="⛔ Minimal 15 menit!";return}a.value.some(x=>{if(c.value&&x.id===e.id||!x.start_time)return!1;const E=b(x.start_time);let M=x.end_time?b(x.end_time):E+60;return M<E&&(M+=1440),t<M&&l>E})&&(o.value="⚠️ Jadwal bentrok!")};N(()=>[e.start_time,e.end_time],T);const p=()=>{if(!e.title||e.title.trim()==="")return u("Judulnya diisi dulu, Bro!");if(g.value==="full"){if(!e.start_time||!e.end_time)return u("Tentukan jam mulai & selesai!");if(T(),o.value)return}else e.start_time=null,e.end_time=null;const t={...e.data()};if(i.value=!1,c.value){const l=a.value.findIndex(_=>_.id===e.id);l!==-1&&(a.value[l]={...a.value[l],...t}),C.patch(route("planner.update",e.id),t,{preserveScroll:!0,onFinish:()=>e.reset()})}else{const l="temp_"+Date.now();a.value.push({...t,id:l,is_completed:!1}),C.post(route("planner.store"),t,{preserveScroll:!0,onError:()=>{a.value=a.value.filter(_=>_.id!==l),u("Gagal menyimpan ke server!")},onFinish:()=>e.reset()})}},d=t=>{a.value=a.value.filter(l=>l.id!==t),i.value=!1,C.delete(route("planner.destroy",t),{preserveScroll:!0})},n=t=>{t.is_completed=!t.is_completed,C.patch(route("planner.toggle",{plannerTask:t.id}),{},{preserveScroll:!0,preserveState:!0})};N(()=>h.tasks,t=>{a.value=[...t]},{deep:!0});const s=D(()=>a.value.filter(t=>t.start_time).sort((t,l)=>t.start_time.localeCompare(l.start_time))),m=D(()=>a.value.filter(t=>!t.start_time)),f=t=>{const l=t.length,_=t.filter(y=>y.is_completed).length;return{total:l,completed:_,percent:l>0?Math.round(_/l*100):0}},w=D(()=>f(s.value)),v=D(()=>f(m.value));return{localTasks:a,scheduledTasks:s,inboxTasks:m,scheduledStats:w,inboxStats:v,form:e,isModalOpen:i,isEditing:c,activeModalType:g,conflictError:o,openModal:(t=null,l=null,_="full")=>{if(e.reset(),e.clearErrors(),o.value=null,g.value=_,t)c.value=!0,e.id=t.id,e.title=t.title,e.start_time=t.start_time,e.end_time=t.end_time,e.type=t.type,e.notes=t.notes||"";else if(c.value=!1,e.id=null,l){e.start_time=l;const[y,x]=l.split(":").map(Number);e.end_time=`${(y+1).toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`}i.value=!0},submitTask:p,deleteTask:d,toggleComplete:n}}function tt(h){return{onDragStart:(i,c)=>{i.dataTransfer.dropEffect="move",i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("taskId",c.id)},onDrop:async(i,c)=>{const g=parseInt(i.dataTransfer.getData("taskId")),e=h.value.find(u=>u.id===g);if(e){e.start_time=c,e.end_time=null;try{await L.patch(route("planner.update",g),{start_time:c,end_time:null})}catch(u){console.error("Gagal update timeline:",u)}}}}}const et=(h,a)=>{let o;return(...i)=>{clearTimeout(o),o=setTimeout(()=>h(...i),a)}};function ot(h){var d,n;const a=X(h),o=tt(a.localTasks),i=k(((d=h.dailyLog)==null?void 0:d.notes)||""),c=k(((n=h.dailyLog)==null?void 0:n.meals)||{breakfast:"",lunch:"",dinner:""}),g=k("full"),e=et(async s=>{try{await L.post(route("planner.updateLog"),s)}catch(m){console.error("Auto-save failed:",m)}},1e3);N(i,s=>e({notes:s})),N(c,s=>e({meals:s}),{deep:!0});const u=Array.from({length:18},(s,m)=>`${(m+6).toString().padStart(2,"0")}:00`);return{...a,...o,openModal:(s=null,m=null,f="full")=>{g.value=f,a.openModal(s,m)},activeModalType:g,resetBoard:()=>{A.fire({title:"Hapus Semua Jadwal?",text:"Aksi ini tidak bisa dibatalkan, Bro!",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Bersihkan!",cancelButtonText:"Batal",buttonsStyling:!1,customClass:{popup:"rounded-[2.5rem] p-8 border border-slate-100 shadow-2xl",title:"text-2xl font-black text-slate-800 mb-2 font-sans",htmlContainer:"text-sm text-slate-500 font-bold mb-4",confirmButton:"bg-rose-500 text-white font-black py-4 px-8 rounded-2xl shadow-xl shadow-rose-200 active:scale-95 transition-all mx-2",cancelButton:"bg-slate-100 text-slate-400 font-black py-4 px-8 rounded-2xl hover:bg-slate-200 active:scale-95 transition-all mx-2",actions:"mt-6 gap-2"}}).then(s=>{s.isConfirmed&&(i.value="",c.value={breakfast:"",lunch:"",dinner:""},a.localTasks.value=[],C.post(route("planner.reset"),{},{preserveScroll:!0,onSuccess:()=>{window.dispatchEvent(new Event("reset-local-storage")),A.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,background:"#4f46e5",iconColor:"#ffffff",icon:"success",title:'<span style="color: white; font-weight: 900;">Jadwal Direset!</span>',customClass:{container:"!fixed !top-5 !right-5 !z-[100000]",popup:"!rounded-full !shadow-2xl"}})}}))})},timeSlots:u,getTypeColor:s=>({1:"bg-rose-50 text-rose-700 border-rose-200",2:"bg-indigo-50 text-indigo-700 border-indigo-200",3:"bg-emerald-50 text-emerald-700 border-emerald-200"})[s]||"bg-white text-slate-700 border-slate-200",localNotes:i,localMeals:c}}function at(){const h=k(!1),a=k(null),o=F({tasks:[{title:"",start_time:"08:00",end_time:"09:00",type:1,notes:""}]}),i=()=>{o.reset(),o.tasks=[{title:"",start_time:"08:00",end_time:"09:00",type:1,notes:""}],o.clearErrors(),a.value=null,h.value=!0},c=()=>{h.value=!1,o.reset(),o.clearErrors(),a.value=null},g=()=>{const p=o.tasks[o.tasks.length-1];let d="09:00";p&&p.end_time&&(d=p.end_time);let[n,s]=d.split(":").map(Number),f=`${((n+1)%24).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;o.tasks.push({title:"",start_time:d,end_time:f,type:1,notes:""})},e=p=>{o.tasks.length>1&&o.tasks.splice(p,1)},u=p=>{if(!p)return 0;const[d,n]=p.split(":").map(Number);return d*60+n},b=()=>{o.clearErrors(),a.value=null;const p=J().props.tasks||[];let d=!0;if(o.tasks.forEach((n,s)=>{n.title||(o.setError(`tasks.${s}.title`,"Required"),d=!1);const m=u(n.start_time);let f=u(n.end_time);f<m&&(f+=1440),f-m<15&&(o.setError(`tasks.${s}.end_time`,"Min 15 mins"),a.value=`Row ${s+1}: Duration must be at least 15 minutes!`,d=!1),p.some(v=>{if(!v.start_time||!v.end_time)return!1;const S=u(v.start_time);let t=u(v.end_time);return t<S&&(t+=1440),m<t&&f>S})&&(a.value=`Row ${s+1}: Clashes with an existing schedule!`,o.setError(`tasks.${s}.start_time`,"Clash!"),d=!1)}),!d)return!1;for(let n=0;n<o.tasks.length;n++){const s=o.tasks[n],m=u(s.start_time);let f=u(s.end_time);f<m&&(f+=1440);for(let w=n+1;w<o.tasks.length;w++){const v=o.tasks[w],S=u(v.start_time);let t=u(v.end_time);t<S&&(t+=1440),m<t&&f>S&&(a.value=`Row ${n+1} and Row ${w+1} are overlapping!`,o.setError(`tasks.${n}.start_time`,"Overlap"),o.setError(`tasks.${w}.start_time`,"Overlap"),d=!1)}}return d};return{isBatchModalOpen:h,batchForm:o,globalConflictError:a,openBatchModal:i,closeBatchModal:c,addBatchRow:g,removeBatchRow:e,submitBatch:()=>{b()&&o.post(route("planner.batchStore"),{preserveScroll:!0,onSuccess:()=>{c()},onError:p=>{console.error("Batch Error",p)}})}}}const st={class:"w-full min-h-screen bg-slate-50/50 px-4 sm:px-6 lg:px-8 py-8"},lt={class:"grid grid-cols-1 lg:grid-cols-5 gap-8 items-start"},rt={class:"lg:col-span-3 order-1 lg:order-2 w-full"},nt={class:"lg:col-span-2 order-2 lg:order-1 w-full space-y-6 md:sticky md:top-24"},Tt={__name:"Index",props:{tasks:Array,dailyLog:Object},setup(h){const a=h,{scheduledTasks:o,timeSlots:i,scheduledStats:c,form:g,isModalOpen:e,isEditing:u,openModal:b,submitTask:T,deleteTask:p,resetBoard:d,toggleComplete:n,onDragStart:s,onDrop:m,getTypeColor:f,localNotes:w,localMeals:v,conflictError:S}=ot(a),{isBatchModalOpen:t,batchForm:l,openBatchModal:_,addBatchRow:y,removeBatchRow:x,submitBatch:E}=at(),M=()=>{e.value=!1,_()},O=()=>{t.value=!1,b()},j=()=>{d(),window.dispatchEvent(new Event("reset-local-storage"))};return(it,$)=>(U(),V(G,null,[B(r(z),{title:"Daily Planner"}),B(q,null,{default:H(()=>[B(Q,{openModal:()=>r(b)(null,null,"full"),resetBoard:j,stats:r(c)},null,8,["openModal","stats"]),R("div",st,[R("div",lt,[R("div",rt,[B(Y,{timeSlots:r(i),scheduledTasks:r(o),onDrop:r(m),onDragStart:r(s),openModal:r(b),toggleComplete:r(n),getTypeColor:r(f)},null,8,["timeSlots","scheduledTasks","onDrop","onDragStart","openModal","toggleComplete","getTypeColor"])]),R("div",nt,[B(W,{stats:r(c),localNotes:r(w),"onUpdate:localNotes":$[0]||($[0]=P=>I(w)?w.value=P:null),localMeals:r(v),"onUpdate:localMeals":$[1]||($[1]=P=>I(v)?v.value=P:null)},null,8,["stats","localNotes","localMeals"])])])]),B(Z,{show:r(e),form:r(g),isEditing:r(u),conflictError:r(S),close:()=>e.value=!1,submit:r(T),remove:r(p),onSwitchToBatch:M},null,8,["show","form","isEditing","conflictError","close","submit","remove"]),B(K,{show:r(t),form:r(l),conflictError:r(S),close:()=>t.value=!1,submit:r(E),addRow:r(y),removeRow:r(x),switchToSingle:O},null,8,["show","form","conflictError","close","submit","addRow","removeRow"])]),_:1})],64))}};export{Tt as default};
