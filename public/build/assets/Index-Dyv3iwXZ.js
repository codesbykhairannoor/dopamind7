import{y as S,T as j,A as N,x as D,b as C,t as V,W as F,a as J,Q as z,d as G,e as B,u as n,Z as H,w as U,f as R,a2 as O,F as W,o as q}from"./vendor-BNleA0cf.js";import{_ as Q}from"./AuthenticatedLayout-C9pBm3K_.js";import Y from"./PlannerHeader-DKCnT4CG.js";import Z from"./PlannerSidebar-FFUEUtgA.js";import K from"./PlannerTimeline-C8S-kmkz.js";import X from"./PlannerModal-C_28Pt6x.js";import tt from"./PlannerBatchModal-CS10lCkM.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-B0UrVx8a.js";import"./InputLabel-CZiz4Zsm.js";import"./TextInput-D1BKPGyI.js";import"./PrimaryButton-DdBuDkGo.js";import"./SecondaryButton-BLJPOq9C.js";function et(h){const a=S([...h.tasks]),s=S(null),c=S(!1),u=S(!1),w=S("full"),e=j({id:null,title:"",start_time:null,end_time:null,type:1,notes:""}),l=(t,o)=>{const p=V(t);return p!==t?p:o},x=(t,o,p="#4f46e5")=>{F.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,background:p,iconColor:"#ffffff",icon:t,title:`<span style="color: white; font-weight: 900; font-size: 14px;">${o}</span>`,customClass:{container:"!fixed !top-5 !right-5 !p-0 !z-[100000] !items-start !justify-end",popup:"!flex !items-center !gap-3 !py-3 !px-6 !rounded-full !shadow-2xl !border-none !w-auto !h-auto !min-w-[280px] !m-0"}})},E=t=>x("warning",t,"#4f46e5"),m=t=>x("success",t,"#4f46e5"),d=t=>x("error",t,"#4f46e5"),i=t=>{if(!t)return 0;const[o,p]=t.split(":").map(Number);return o*60+p},r=()=>{if(s.value=null,!e.start_time||!e.end_time)return;const t=i(e.start_time);let o=i(e.end_time);if(o<t&&(o+=1440),o-t<15){s.value=`⛔ ${l("err_min_15_mins","Minimal 15 menit!")}`;return}a.value.some(T=>{if(u.value&&T.id===e.id||!T.start_time)return!1;const $=i(T.start_time);let y=T.end_time?i(T.end_time):$+60;return y<$&&(y+=1440),t<y&&o>$})&&(s.value=`⚠️ ${l("err_schedule_conflict","Jadwal bentrok!")}`)};N(()=>[e.start_time,e.end_time],r);const f=()=>{if(!e.title||e.title.trim()==="")return E(l("warn_empty_title","Judulnya diisi dulu, Bro!"));if(w.value==="full"){if(!e.start_time||!e.end_time)return E(l("warn_empty_time","Tentukan jam mulai & selesai!"));if(r(),s.value)return}else e.start_time=null,e.end_time=null;const t={...e.data()};if(c.value=!1,m(l("success_saved","Tersimpan!")),u.value){const o=a.value.findIndex(p=>p.id===e.id);o!==-1&&(a.value[o]={...a.value[o],...t}),C.patch(route("planner.update",e.id),t,{preserveScroll:!0,onFinish:()=>e.reset()})}else{const o="temp_"+Date.now();a.value.push({...t,id:o,is_completed:!1}),C.post(route("planner.store"),t,{preserveScroll:!0,onError:()=>{a.value=a.value.filter(p=>p.id!==o),d(l("err_save_failed","Gagal menyimpan ke server!"))},onFinish:()=>e.reset()})}},_=t=>{a.value=a.value.filter(o=>o.id!==t),c.value=!1,m(l("success_deleted","Dihapus!")),C.delete(route("planner.destroy",t),{preserveScroll:!0,onError:()=>{d(l("err_delete_failed","Gagal menghapus data!"))}})},b=t=>{t.is_completed=!t.is_completed,C.patch(route("planner.toggle",{plannerTask:t.id}),{},{preserveScroll:!0,preserveState:!0})};N(()=>h.tasks,t=>{a.value=[...t]},{deep:!0});const g=D(()=>a.value.filter(t=>t.start_time).sort((t,o)=>t.start_time.localeCompare(o.start_time))),k=D(()=>a.value.filter(t=>!t.start_time)),v=t=>{const o=t.length,p=t.filter(M=>M.is_completed).length;return{total:o,completed:p,percent:o>0?Math.round(p/o*100):0}},P=D(()=>v(g.value)),A=D(()=>v(k.value));return{localTasks:a,scheduledTasks:g,inboxTasks:k,scheduledStats:P,inboxStats:A,form:e,isModalOpen:c,isEditing:u,activeModalType:w,conflictError:s,openModal:(t=null,o=null,p="full")=>{if(e.reset(),e.clearErrors(),s.value=null,w.value=p,t)u.value=!0,e.id=t.id,e.title=t.title,e.start_time=t.start_time,e.end_time=t.end_time,e.type=t.type,e.notes=t.notes||"";else if(u.value=!1,e.id=null,o){e.start_time=o;const[M,T]=o.split(":").map(Number);e.end_time=`${(M+1).toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`}c.value=!0},submitTask:f,deleteTask:_,toggleComplete:b}}function st(h){return{onDragStart:(c,u)=>{c.dataTransfer.dropEffect="move",c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("taskId",u.id)},onDrop:async(c,u)=>{const w=parseInt(c.dataTransfer.getData("taskId")),e=h.value.find(l=>l.id===w);if(e){e.start_time=u,e.end_time=null;try{await J.patch(route("planner.update",w),{start_time:u,end_time:null})}catch(l){console.error("Gagal update timeline:",l)}}}}}const at=(h,a)=>{let s;return(...c)=>{clearTimeout(s),s=setTimeout(()=>h(...c),a)}};function ot(h){var d,i;const a=et(h),s=st(a.localTasks),c=S(((d=h.dailyLog)==null?void 0:d.notes)||""),u=S(((i=h.dailyLog)==null?void 0:i.meals)||{breakfast:"",lunch:"",dinner:""}),w=S("full"),e=at(async r=>{try{await J.post(route("planner.updateLog"),r)}catch(f){console.error("Auto-save failed:",f)}},1e3);N(c,r=>e({notes:r})),N(u,r=>e({meals:r}),{deep:!0});const l=Array.from({length:18},(r,f)=>`${(f+6).toString().padStart(2,"0")}:00`);return{...a,...s,openModal:(r=null,f=null,_="full")=>{w.value=_,a.openModal(r,f)},activeModalType:w,resetBoard:()=>{F.fire({title:"Hapus Semua Jadwal?",text:"Aksi ini tidak bisa dibatalkan, Bro!",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Bersihkan!",cancelButtonText:"Batal",buttonsStyling:!1,customClass:{popup:"rounded-[2.5rem] p-8 border border-slate-100 shadow-2xl",title:"text-2xl font-black text-slate-800 mb-2 font-sans",htmlContainer:"text-sm text-slate-500 font-bold mb-4",confirmButton:"bg-rose-500 text-white font-black py-4 px-8 rounded-2xl shadow-xl shadow-rose-200 active:scale-95 transition-all mx-2",cancelButton:"bg-slate-100 text-slate-400 font-black py-4 px-8 rounded-2xl hover:bg-slate-200 active:scale-95 transition-all mx-2",actions:"mt-6 gap-2"}}).then(r=>{r.isConfirmed&&(c.value="",u.value={breakfast:"",lunch:"",dinner:""},a.localTasks.value=[],C.post(route("planner.reset"),{},{preserveScroll:!0,onSuccess:()=>{window.dispatchEvent(new Event("reset-local-storage")),F.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,background:"#4f46e5",iconColor:"#ffffff",icon:"success",title:'<span style="color: white; font-weight: 900;">Jadwal Direset!</span>',customClass:{container:"!fixed !top-5 !right-5 !z-[100000]",popup:"!rounded-full !shadow-2xl"}})}}))})},timeSlots:l,getTypeColor:r=>({1:"bg-rose-50 text-rose-700 border-rose-200",2:"bg-indigo-50 text-indigo-700 border-indigo-200",3:"bg-emerald-50 text-emerald-700 border-emerald-200"})[r]||"bg-white text-slate-700 border-slate-200",localNotes:c,localMeals:u}}function rt(){const h=S(!1),a=S(null),s=j({tasks:[{title:"",start_time:"08:00",end_time:"09:00",type:1,notes:""}]}),c=()=>{s.reset(),s.tasks=[{title:"",start_time:"08:00",end_time:"09:00",type:1,notes:""}],s.clearErrors(),a.value=null,h.value=!0},u=()=>{h.value=!1,s.reset(),s.clearErrors(),a.value=null},w=()=>{const m=s.tasks[s.tasks.length-1];let d="09:00";m&&m.end_time&&(d=m.end_time);let[i,r]=d.split(":").map(Number),_=`${((i+1)%24).toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`;s.tasks.push({title:"",start_time:d,end_time:_,type:1,notes:""})},e=m=>{s.tasks.length>1&&s.tasks.splice(m,1)},l=m=>{if(!m)return 0;const[d,i]=m.split(":").map(Number);return d*60+i},x=()=>{s.clearErrors(),a.value=null;const m=z().props.tasks||[];let d=!0;if(s.tasks.forEach((i,r)=>{i.title||(s.setError(`tasks.${r}.title`,"Required"),d=!1);const f=l(i.start_time);let _=l(i.end_time);_<f&&(_+=1440),_-f<15&&(s.setError(`tasks.${r}.end_time`,"Min 15 mins"),a.value=`Row ${r+1}: Duration must be at least 15 minutes!`,d=!1),m.some(g=>{if(!g.start_time||!g.end_time)return!1;const k=l(g.start_time);let v=l(g.end_time);return v<k&&(v+=1440),f<v&&_>k})&&(a.value=`Row ${r+1}: Clashes with an existing schedule!`,s.setError(`tasks.${r}.start_time`,"Clash!"),d=!1)}),!d)return!1;for(let i=0;i<s.tasks.length;i++){const r=s.tasks[i],f=l(r.start_time);let _=l(r.end_time);_<f&&(_+=1440);for(let b=i+1;b<s.tasks.length;b++){const g=s.tasks[b],k=l(g.start_time);let v=l(g.end_time);v<k&&(v+=1440),f<v&&_>k&&(a.value=`Row ${i+1} and Row ${b+1} are overlapping!`,s.setError(`tasks.${i}.start_time`,"Overlap"),s.setError(`tasks.${b}.start_time`,"Overlap"),d=!1)}}return d};return{isBatchModalOpen:h,batchForm:s,globalConflictError:a,openBatchModal:c,closeBatchModal:u,addBatchRow:w,removeBatchRow:e,submitBatch:()=>{x()&&s.post(route("planner.batchStore"),{preserveScroll:!0,onSuccess:()=>{u()},onError:m=>{console.error("Batch Error",m)}})}}}const lt={class:"w-full min-h-screen bg-slate-50/50 px-4 sm:px-6 lg:px-8 py-8"},nt={class:"grid grid-cols-1 lg:grid-cols-5 gap-8 items-start"},it={class:"lg:col-span-3 order-1 lg:order-2 w-full"},ct={class:"lg:col-span-2 order-2 lg:order-1 w-full space-y-6 md:sticky md:top-24"},St={__name:"Index",props:{tasks:Array,dailyLog:Object},setup(h){const a=h,{scheduledTasks:s,timeSlots:c,scheduledStats:u,form:w,isModalOpen:e,isEditing:l,openModal:x,submitTask:E,deleteTask:m,resetBoard:d,toggleComplete:i,onDragStart:r,onDrop:f,getTypeColor:_,localNotes:b,localMeals:g,conflictError:k}=ot(a),{isBatchModalOpen:v,batchForm:P,openBatchModal:A,addBatchRow:L,removeBatchRow:t,submitBatch:o}=rt(),p=()=>{e.value=!1,A()},M=()=>{v.value=!1,x()},T=()=>{d(),window.dispatchEvent(new Event("reset-local-storage"))};return($,y)=>(q(),G(W,null,[B(n(H),{title:"Daily Planner"}),B(Q,null,{default:U(()=>[B(Y,{openModal:()=>n(x)(null,null,"full"),resetBoard:T,stats:n(u)},null,8,["openModal","stats"]),R("div",lt,[R("div",nt,[R("div",it,[B(K,{timeSlots:n(c),scheduledTasks:n(s),onDrop:n(f),onDragStart:n(r),openModal:n(x),toggleComplete:n(i),getTypeColor:n(_)},null,8,["timeSlots","scheduledTasks","onDrop","onDragStart","openModal","toggleComplete","getTypeColor"])]),R("div",ct,[B(Z,{stats:n(u),localNotes:n(b),"onUpdate:localNotes":y[0]||(y[0]=I=>O(b)?b.value=I:null),localMeals:n(g),"onUpdate:localMeals":y[1]||(y[1]=I=>O(g)?g.value=I:null)},null,8,["stats","localNotes","localMeals"])])])]),B(X,{show:n(e),form:n(w),isEditing:n(l),conflictError:n(k),close:()=>e.value=!1,submit:n(E),remove:n(m),onSwitchToBatch:p},null,8,["show","form","isEditing","conflictError","close","submit","remove"]),B(tt,{show:n(v),form:n(P),conflictError:n(k),close:()=>v.value=!1,submit:n(o),addRow:n(L),removeRow:n(t),switchToSingle:M},null,8,["show","form","conflictError","close","submit","addRow","removeRow"])]),_:1})],64))}};export{St as default};
