import{T as xe,B as O,r as b,t as ye,p as z,C as we,a as y,b as p,d as a,u as o,Z as _e,k as Me,m as Y,e as m,s as K,l as Be,w as Ce,o as h,q as ke,F as H,x as De}from"./vendor-vue-DauRGcU0.js";import{A as Ee}from"./AuthenticatedLayout-CBYjT401.js";import{d as j}from"./vendor-core-CR-nZrr5.js";import $e from"./FinanceHeader-bc8QSX-c.js";import Fe from"./FinanceStats-Nwv7ReJ0.js";import Te from"./BudgetSidebar-D1UrO07T.js";import Se from"./TransactionModal-B_-sGpmO.js";import Ye from"./BudgetModal-DU45PvLD.js";import Oe from"./CategoryModal-FIX8qW6x.js";import je from"./DailyTrendChart-vL4LBqgh.js";import Ae from"./ArchiveModal-BFqPjpqm.js";import{u as Re,F as Ie}from"./FinanceInsights-B6pMd7Ku.js";import Le from"./FinanceDatePicker-BwFKiqP_.js";import ze from"./FinanceBatchModal-CmG0Lgfc.js";import{S as Ne}from"./vendor-utils-DJxZWvYm.js";import{u as N}from"./useFinanceFormat-EQ3fHtmQ.js";import{N as U}from"./vendor-inertia-DdYq9B8h.js";import{u as Ve}from"./useFinanceHistory-CgmmoFrX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-BaKyiO_R.js";import"./TextInput-OKSiZA2l.js";import"./PrimaryButton-PYkNO_iO.js";import"./SecondaryButton-DxRvAQCY.js";function Pe(d){const c=b(!1),n=b(null),{cleanAmount:u}=N(),r=(l,g)=>{const v=ye(l);return v!==l?v:g},_=(l,g)=>{Ne.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,background:"#4f46e5",iconColor:"#ffffff",icon:l,title:`<span style="color: white; font-weight: 900; font-size: 14px; line-height: 1.2;">${g}</span>`,customClass:{container:"!fixed !top-5 !right-5 !p-0 !z-[100000] !items-start !justify-end",popup:"!flex !items-center !gap-3 !py-3 !px-6 !rounded-full !shadow-2xl !border-none !m-0 !w-auto !min-w-[280px]",timerProgressBar:"!bg-white/40 !h-1 !rounded-b-full"}})},i=xe({date:d.value,transactions:[{type:"expense",category:"",title:"",amount:""}]});O(()=>d.value,l=>{c.value||(i.date=l)});const k=()=>{i.reset(),i.date=d.value,i.transactions=[{type:"expense",category:"",title:"",amount:""}],i.clearErrors(),n.value=null,c.value=!0},f=()=>{c.value=!1,i.reset(),i.clearErrors()},D=()=>{i.transactions.push({type:"expense",category:"",title:"",amount:""})},A=l=>{i.transactions.length>1&&i.transactions.splice(l,1)},R=()=>{i.clearErrors(),n.value=null;let l=!0;return i.date?(i.transactions.forEach((g,v)=>{g.title||(i.setError(`transactions.${v}.title`,r("warn_empty_title","Required")),l=!1),g.category||(i.setError(`transactions.${v}.category`,r("warn_empty_category","Required")),l=!1),(!g.amount||u(g.amount)<=0)&&(i.setError(`transactions.${v}.amount`,r("warn_empty_amount","Required")),l=!1)}),l||_("warning",r("warn_empty_fields","Lengkapi semua baris transaksi!")),l):(_("warning",r("warn_empty_date","Pilih tanggal transaksi!")),!1)};return{isBatchModalOpen:c,batchForm:i,globalConflictError:n,openBatchModal:k,closeBatchModal:f,addBatchRow:D,removeBatchRow:A,submitBatch:({onOptimistic:l,onSuccess:g,onError:v}={})=>{if(!R())return;const x={date:i.date,transactions:i.transactions.map(M=>({...M,amount:u(M.amount)}))},S=x.transactions.map((M,T)=>({...M,id:"temp_batch_"+Date.now()+"_"+T,date:x.date,created_at:new Date().toISOString()}));l&&l(S),f(),_("success",r("success_saved","Batch Saved!")),U.post(route("finance.transaction.batchStore"),x,{preserveScroll:!0,preserveState:!0,progress:!1,onSuccess:()=>{g&&g()},onError:M=>{v&&v(S.map(T=>T.id)),i.date=x.date,i.transactions=x.transactions,c.value=!0,_("error",Object.values(M)[0]||r("err_save_failed","Gagal menyimpan data!"))}})}}}function qe(d){const{activeLocale:c}=N(),n=b(j(d)),u=z(()=>!c||!c.value?"en":c.value.split("-")[0]),r=k=>{let f;k==="next"?f=n.value.add(1,"month"):k==="prev"?f=n.value.subtract(1,"month"):f=j(`${k}-01`),n.value=f,U.get(route("finance.index"),{date:f.format("YYYY-MM-DD")},{preserveState:!0,preserveScroll:!0,replace:!0,only:["transactions","budgets","stats","filters"]})},_=z(()=>n.value.locale(u.value).format("MMMM YYYY")),i=z(()=>n.value.format("YYYY-MM"));return{currentDate:n,changeMonth:r,formattedMonth:_,currentMonthKey:i}}const Ke={class:"w-full min-h-screen bg-slate-50/50 px-4 sm:px-6 lg:px-8 py-8"},He={class:"mb-8"},Ue={class:"grid grid-cols-1 lg:grid-cols-5 gap-8 items-start"},Ge={class:"lg:col-span-3 space-y-8 w-full"},Ze={class:"space-y-4"},Je={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-3"},Qe={class:"flex items-center gap-2"},We={class:"text-lg font-bold text-slate-800"},Xe={key:0,class:"text-[10px] font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded-lg"},et={key:1,class:"text-[10px] font-bold text-indigo-500 bg-indigo-50 px-2 py-1 rounded-lg"},tt={class:"relative z-30"},st={class:"flex items-center gap-2"},at={class:"absolute right-3 text-slate-400 text-[10px]"},ot={key:0,class:"absolute right-0 top-full mt-2 z-50 origin-top-right"},nt={key:0,class:"text-center py-12 bg-white rounded-3xl border border-dashed border-slate-200"},rt={class:"text-slate-400 text-sm font-medium"},lt={key:1,class:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden divide-y divide-slate-50"},it=["onClick"],ct={class:"flex items-center gap-4"},ut={class:"w-12 h-12 rounded-xl bg-slate-50 border border-slate-100 flex flex-col items-center justify-center group-hover:bg-white transition-all shadow-sm"},dt={class:"text-[10px] uppercase font-black text-slate-400 leading-none"},mt={class:"text-xl font-black leading-none text-slate-700 mt-0.5"},ft={class:"font-bold text-slate-700 text-sm capitalize"},gt={class:"text-[11px] text-slate-400 font-bold bg-slate-50 px-1.5 py-0.5 rounded border border-slate-100 mt-1 inline-block"},pt={class:"flex items-center gap-6"},vt={class:"pl-4 border-l border-slate-100 text-right"},ht={class:"block text-[9px] font-bold text-slate-400 uppercase tracking-wider"},bt={key:0,class:"bg-slate-50/50 p-2.5 text-center border-t border-slate-100"},xt={class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},yt={class:"lg:col-span-2 w-full md:sticky md:top-24 h-fit space-y-6"},qt=Object.assign({layout:Ee},{__name:"Index",props:{transactions:Array,budgets:Array,stats:Object,filters:Object,categories:Array},setup(d){const c=d,n=b([...c.transactions]),u=b([...c.budgets]),r=b([...c.categories]);O(()=>c.transactions,e=>n.value=[...e],{deep:!0}),O(()=>c.budgets,e=>u.value=[...e],{deep:!0}),O(()=>c.categories,e=>r.value=[...e],{deep:!0});const _=we({...c,get transactions(){return n.value},get budgets(){return u.value},get categories(){return r.value}}),{formattedMonth:i,changeMonth:k,currentMonthKey:f}=qe(c.filters.date),{transactionForm:D,setEditTransaction:A,submitTransaction:R,deleteTransaction:V,budgetForm:l,submitBudget:g,deleteBudget:v,categoryForm:x,setEditCategory:S,submitCategory:M,deleteCategory:T,updateIncomeTarget:G}=Re(),B=b(!1),E=b(!1),$=b(!1),F=b(!1),Z=b(c.filters.date||j().format("YYYY-MM-DD")),{isBatchModalOpen:J,batchForm:Q,globalConflictError:W,openBatchModal:X,closeBatchModal:P,addBatchRow:ee,removeBatchRow:te,submitBatch:se}=Pe(Z),{visibleStats:q,filterDate:w,isArchiveOpen:I,selectedDayData:ae,openDetail:oe}=Ve(_),{formatMoney:ne}=N(),re=e=>{A(e),B.value=!0},le=e=>{const s=r.value.find(t=>t.slug===e.category);l.id=e.id,l.category=e.category,l.name=s?s.name:e.category,l.icon=s?s.icon:"ðŸ’¸",l.limit_amount=e.limit_amount,l.month=e.month||f.value,E.value=!0},ie=e=>{x.id=e.id,S(e),$.value=!0},ce=()=>{x.reset(),x.id=null,$.value=!0},ue=()=>{R({onOptimistic:(e,s)=>{if(B.value=!1,s){const t=n.value.findIndex(C=>C.id===e.id);t!==-1&&Object.assign(n.value[t],e)}else n.value.unshift(e)},onError:(e,s)=>{s||(n.value=n.value.filter(t=>t.id!==e)),B.value=!0}})},de=e=>{I.value=!1,V(e,{onOptimistic:s=>{n.value=n.value.filter(t=>t.id!==s)}})},me=()=>{se({onOptimistic:e=>{n.value.unshift(...e)},onError:e=>{n.value=n.value.filter(s=>!e.includes(s.id))}})},fe=()=>{E.value=!1,g(f.value,{onOptimistic:(e,s)=>{if(s){const t=u.value.findIndex(L=>L.id===e.id);t!==-1&&Object.assign(u.value[t],e);const C=r.value.findIndex(L=>L.slug===e.category);C!==-1&&(r.value[C].name=e.name,r.value[C].icon=e.icon)}else u.value.push(e),r.value.find(t=>t.slug===e.category)||r.value.push({id:"temp_"+Date.now(),slug:e.category,name:e.name,icon:e.icon,type:"expense"})},onError:(e,s)=>{s||(u.value=u.value.filter(t=>t.id!==e)),E.value=!0}})},ge=()=>{$.value=!1,M({onOptimistic:(e,s)=>{if(s){const t=r.value.findIndex(C=>C.id===e.id);t!==-1&&(r.value[t].name=e.name,r.value[t].icon=e.icon)}else r.value.push(e)},onError:(e,s)=>{s||(r.value=r.value.filter(t=>t.id!==e)),$.value=!0}})},pe=e=>{v(e,{onOptimistic:s=>{u.value=u.value.filter(t=>t.id!==s)}})},ve=e=>{T(e,{onOptimistic:s=>{r.value=r.value.filter(t=>t.id!==s)}})},he=()=>{B.value=!1,setTimeout(()=>{X()},150)},be=()=>{P(),setTimeout(()=>{D.reset(),D.id=null,B.value=!0},150)};return(e,s)=>(h(),y(H,null,[p(o(_e),{title:"Finance Plan"}),a("div",null,[p($e,{currentMonth:o(i),currentMonthKey:o(f),onChangeDate:t=>o(k)(t),onAddClick:()=>{o(D).reset(),o(D).id=null,B.value=!0}},null,8,["currentMonth","currentMonthKey","onChangeDate","onAddClick"]),a("div",Ke,[a("div",He,[p(Fe,{stats:d.stats,onUpdateTarget:t=>o(G)(o(f),t)},null,8,["stats","onUpdateTarget"])]),a("div",Ue,[a("div",Ge,[a("div",Ze,[a("div",Je,[a("div",Qe,[a("h3",We,m(e.$t("daily_history")),1),o(w)?(h(),y("span",et,m(e.$t("search_result")),1)):(h(),y("span",Xe,m(e.$t("last_5")),1))]),a("div",tt,[a("div",st,[a("button",{onClick:s[0]||(s[0]=t=>F.value=!F.value),class:K(["pl-3 pr-8 py-2 text-xs font-bold bg-white border border-slate-200 rounded-xl shadow-sm hover:border-indigo-300 hover:ring-2 hover:ring-indigo-500/10 transition-all flex items-center gap-2 min-w-[150px] relative",o(w)?"text-indigo-600 border-indigo-200":"text-slate-500"])},[s[5]||(s[5]=a("span",{class:"text-base"},"ðŸ“…",-1)),a("span",null,m(o(w)?o(j)(o(w)).locale(e.$page.props.locale).format("DD MMM YYYY"):e.$t("date_filter")),1),a("span",at,m(F.value?"â–²":"â–¼"),1)],2),o(w)?(h(),y("button",{key:0,onClick:s[1]||(s[1]=Be(t=>w.value="",["stop"])),class:"text-slate-300 hover:text-rose-500 hover:bg-rose-50 p-1.5 rounded-lg transition-all border border-transparent hover:border-rose-100",title:"Hapus Filter"},[...s[6]||(s[6]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])):Y("",!0)]),p(ke,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-2"},{default:Ce(()=>[F.value?(h(),y("div",ot,[p(Le,{show:F.value,modelValue:o(w),transactions:n.value,"onUpdate:modelValue":s[2]||(s[2]=t=>w.value=t),onClose:s[3]||(s[3]=t=>F.value=!1)},null,8,["show","modelValue","transactions"])])):Y("",!0)]),_:1})])]),n.value.length===0?(h(),y("div",nt,[s[7]||(s[7]=a("div",{class:"text-3xl mb-2"},"ðŸ“’",-1)),a("p",rt,m(e.$t("no_transaction")),1)])):(h(),y("div",lt,[(h(!0),y(H,null,De(o(q),t=>(h(),y("div",{key:t.date,onClick:C=>o(oe)(t),class:"group p-4 flex items-center justify-between hover:bg-indigo-50/50 transition-colors cursor-pointer"},[a("div",ct,[a("div",ut,[a("span",dt,m(t.dateObj.format("MMM")),1),a("span",mt,m(t.dateObj.format("DD")),1)]),a("div",null,[a("h4",ft,m(t.dateObj.format("dddd")),1),a("span",gt,m(e.$t("transaction_count",{count:t.transactions.length})),1)])]),a("div",pt,[a("div",vt,[a("span",ht,m(e.$t("daily_net")),1),a("span",{class:K(["text-sm font-black font-mono",t.total_income-t.total_expense>=0?"text-indigo-600":"text-orange-500"])},m(t.total_income-t.total_expense>=0?"+":"")+m(o(ne)(t.total_income-t.total_expense)),3)]),s[8]||(s[8]=a("span",{class:"text-slate-300 group-hover:text-indigo-400 transition-colors"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})])],-1))])],8,it))),128)),!o(w)&&o(q).length===5?(h(),y("div",bt,[a("p",xt,m(e.$t("old_data_hint")),1)])):Y("",!0)])),p(Ae,{show:o(I),dayData:o(ae),categories:d.categories,close:()=>I.value=!1,onDelete:de,onEdit:re},null,8,["show","dayData","categories","close"])]),n.value.length?(h(),Me(je,{key:0,transactions:n.value,currentDate:d.filters.date},null,8,["transactions","currentDate"])):Y("",!0)]),a("div",yt,[p(Te,{budgets:u.value,categories:r.value,expenseStats:d.stats.expense_by_category,incomeStats:d.stats.income_by_category,onAdd:s[4]||(s[4]=()=>{o(l).reset(),o(l).id=null,E.value=!0}),onDeleteBudget:pe,onEditBudget:le,onAddCategory:ce,onEditCategory:ie,onDeleteCategory:ve},null,8,["budgets","categories","expenseStats","incomeStats"]),p(Ie,{"expense-stats":d.stats.expense_by_category,"income-stats":d.stats.income_by_category,budgets:u.value},null,8,["expense-stats","income-stats","budgets"])])]),p(Se,{show:B.value,form:o(D),budgets:u.value,categories:d.categories,close:()=>B.value=!1,submit:ue,onSwitchToBatch:he},null,8,["show","form","budgets","categories","close"]),p(ze,{show:o(J),form:o(Q),categories:d.categories,budgets:u.value,conflictError:o(W),close:o(P),submit:me,addRow:o(ee),removeRow:o(te),switchToSingle:be},null,8,["show","form","categories","budgets","conflictError","close","addRow","removeRow"]),p(Ye,{show:E.value,form:o(l),categories:d.categories,close:()=>E.value=!1,submit:fe},null,8,["show","form","categories","close"]),p(Oe,{show:$.value,form:o(x),close:()=>$.value=!1,submit:ge},null,8,["show","form","close"])])])],64))}});export{qt as default};
